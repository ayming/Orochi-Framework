//licensed under the MIT license: http://orochis-den.com/license
_=new _WebOO($);Orochi=_.Class({className:"com.orochis-den.Orochi",body:new function(){var i=this;var k="localhost";var h=8181;var a="http://"+k+":"+h;var l;var m=0;var b=1;var c=2;var g=function(){a="http://"+k+":"+h};var j=function(n){k=n;g()};var e=function(n){h=n;g()};var f=i.nativeServiceName="Orochi";i.hasNativeSupport=false;i.isInWebView=/OrochiNative\/[0-9\.]+$/.test(navigator.userAgent);i.getNativeServiceAddress=function(){return a};i.getNativeServiceDomain=function(){return k};i._const=function(o){if(isset(o.nativeServiceName)){f=o.nativeServiceName}if(isset(o.nativeServicePort)){e(o.nativeServicePort)}if(isset(o.nativeServiceDomain)){j(o.nativeServiceDomain)}l=init_args(o.debugMode,m);var q=init_args(o.onReady,function(){});var p=false;var n=function(v,u){var t;var s=5;for(t=v;t<v+s&&t<=u;t++){(function(w){d({url:"http://"+k+":"+w+"?callback=?",data:{basicHandler:"getDeviceInfo"},requestTimeout:1000,success:function(x,z,y){if(p){return}if(x.requestDone&&x.serviceName==f){i.hasNativeSupport=true;e(w);p=true;i.log("orochi initRequest","success on port: "+w);q()}},error:function(x,z,y){i.log("orochi initRequest","fail on port: "+w)}})})(t)}if(v+s<=u){setTimeout(function(){if(p){return}n(v+s,u)},3000)}};var r=20;n(h,h+r-1);setTimeout(function(){if(!p){i.hasNativeSupport=false;i.log("orochi initRequest","port "+h+"-"+(h+r-1)+" is already in use");q()}},12000)};i.log=function(n,o){if(l==b){alert(n+": "+o)}else{if(l==c){console.log(n+": "+o)}}};var d=i.nativeRequest=function(n){var o=false;var p={url:a+"?callback=?",dataType:"jsonp",cache:false,data:{basicHandler:"getDeviceInfo"},requestTimeout:30000,beforeSend:function(r,q){setTimeout(function(){if(!o){p.error(r,null,null)}},p.requestTimeout)},success:function(q,s,r){if(q.requestDone){p.onSuccess(q,s,r)}else{if(q.requestDone===false&&isset(q.requestID)){p.data={requestID:q.requestID};$.ajax(p)}else{p.onError(r,s,null,q)}}},error:function(q,s,r){i.log("orochi nativeRequest","error");p.onError(q,s,r)},complete:function(q,r){i.log("orochi nativeRequest","complete");o=true},onSuccess:function(q,s,r){},onError:function(r,t,s,q){}};$.extend(p,n);$.ajax(p)}}});